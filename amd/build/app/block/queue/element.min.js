define("block_sharing_cart/app/block/queue/element",["exports","core_courseformat/courseeditor","core/ajax"],(function(_exports,_courseeditor,_ajax){var obj;function _classPrivateFieldInitSpec(obj,privateMap,value){!function(obj,privateCollection){if(privateCollection.has(obj))throw new TypeError("Cannot initialize the same private elements twice on an object")}(obj,privateMap),privateMap.set(obj,value)}function _classPrivateFieldGet(receiver,privateMap){return function(receiver,descriptor){if(descriptor.get)return descriptor.get.call(receiver);return descriptor.value}(receiver,_classExtractFieldDescriptor(receiver,privateMap,"get"))}function _classPrivateFieldSet(receiver,privateMap,value){return function(receiver,descriptor,value){if(descriptor.set)descriptor.set.call(receiver,value);else{if(!descriptor.writable)throw new TypeError("attempted to set read only private field");descriptor.value=value}}(receiver,_classExtractFieldDescriptor(receiver,privateMap,"set"),value),value}function _classExtractFieldDescriptor(receiver,privateMap,action){if(!privateMap.has(receiver))throw new TypeError("attempted to "+action+" private field on non-instance");return privateMap.get(receiver)}Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.default=void 0,_ajax=(obj=_ajax)&&obj.__esModule?obj:{default:obj};var _baseFactory=new WeakMap,_blockElement=new WeakMap,_element=new WeakMap,_reactive=new WeakMap;return _exports.default=class{constructor(baseFactory,blockElement,element){_classPrivateFieldInitSpec(this,_baseFactory,{writable:!0,value:void 0}),_classPrivateFieldInitSpec(this,_blockElement,{writable:!0,value:void 0}),_classPrivateFieldInitSpec(this,_element,{writable:!0,value:void 0}),_classPrivateFieldInitSpec(this,_reactive,{writable:!0,value:void 0}),_classPrivateFieldSet(this,_baseFactory,baseFactory),_classPrivateFieldSet(this,_blockElement,blockElement),_classPrivateFieldSet(this,_element,element),_classPrivateFieldSet(this,_reactive,(0,_courseeditor.getCurrentCourseEditor)()),this.loadQueue(),setInterval((()=>{0!==this.getQueueItems().length&&this.loadQueue()}),4e3)}getQueueItems(){return _classPrivateFieldGet(this,_element).querySelectorAll(".queue-item")}async loadQueue(){let showSpinner=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const oldChildren=_classPrivateFieldGet(this,_element).children,oldQueueItemsCount=this.getQueueItems().length;showSpinner&&(_classPrivateFieldGet(this,_element).innerHTML='<i class="fa fa-spinner"></i>');const elements=await _classPrivateFieldGet(this,_baseFactory).moodle().template().createElementsFromFragment("block_sharing_cart","item_queue",M.cfg.contextid,{}),queueItems=elements.filter((element=>element instanceof Element&&element.classList.contains("queue-item")));if(oldQueueItemsCount>queueItems.length){const removedElements=Array.from(oldChildren).filter((element=>void 0===queueItems.find((el=>el.dataset.id===element.dataset.id)))),sectionIds=[];removedElements.forEach((element=>{const sectionId=element.dataset.toSectionId;-1===sectionIds.indexOf(sectionId)&&sectionIds.push(sectionId)})),sectionIds.length>0&&_classPrivateFieldGet(this,_reactive).dispatch("sectionState",sectionIds)}_classPrivateFieldGet(this,_element).innerHTML="",queueItems.forEach((element=>{element.querySelector(".btn").addEventListener("click",(()=>{const taskId=element.dataset.id;_ajax.default.call([{methodname:"block_sharing_cart_run_task_now",args:{task_id:taskId}}]),this.loadQueue()}))})),elements.forEach((element=>{_classPrivateFieldGet(this,_element).appendChild(element)}))}},_exports.default}));

//# sourceMappingURL=element.min.js.map
{"version":3,"file":"element.min.js","sources":["../../../../src/app/block/item/element.js"],"sourcesContent":["// eslint-disable-next-line no-unused-vars\nimport BaseFactory from '../factory';\nimport ModalFactory from 'core/modal_factory';\nimport ModalEvents from 'core/modal_events';\nimport { get_strings } from \"core/str\";\n\nexport default class ItemElement {\n    /**\n     * @type {BaseFactory}\n     */\n    #baseFactory;\n\n    /**\n     * @type {BlockElement}\n     */\n    #blockElement;\n\n    /**\n     * @type {HTMLElement}\n     */\n    #element;\n\n    constructor(baseFactory, blockElement, element) {\n        this.#baseFactory = baseFactory;\n        this.#blockElement = blockElement;\n        this.#element = element;\n    }\n\n    addEventListeners() {\n        this.#element.addEventListener('click', this.toggleCollapseRecursively.bind(this));\n\n        this.#element.querySelector('[data-action=\"delete\"]')?.addEventListener('click', this.confirmDeleteItem.bind(this));\n        this.#element.querySelector('[data-action=\"copy_to_course\"]')?.addEventListener('click', this.copyItemToCourse.bind(this));\n    }\n\n    async copyItemToCourse(e) {\n        e.preventDefault();\n        e.stopPropagation();\n\n        await this.#blockElement.setClipboard(this);\n    }\n\n    async confirmDeleteItem(e) {\n        e.preventDefault();\n        e.stopPropagation();\n\n        const strings = await get_strings([\n            {\n                key: 'delete_item',\n                component: 'block_sharing_cart',\n            },\n            {\n                key: 'confirm_delete_item',\n                component: 'block_sharing_cart',\n            },\n            {\n                key: 'delete',\n                component: 'core',\n            },\n            {\n                key: 'cancel',\n                component: 'core',\n            }\n        ]);\n\n        const modal = await ModalFactory.create({\n            type: ModalFactory.types.DELETE_CANCEL,\n            title: strings[0] + ': \"' + this.getItemName() + '\"',\n            body: strings[1],\n            buttons: {\n                delete: strings[2],\n                cancel: strings[3],\n            },\n            removeOnClose: true,\n        });\n        modal.getRoot().on(ModalEvents.delete, this.#blockElement.deleteItem.bind(this.#blockElement, this));\n        await modal.show();\n    }\n\n    /**\n     * @return {NodeListOf<HTMLElement>}\n     */\n    getItemChildrenRecursively() {\n        return this.#element.querySelectorAll('.sharing_cart_item');\n    }\n\n    /**\n     * @return {String}\n     */\n    getItemName() {\n        return this.#element.querySelector('.name').innerText;\n    }\n\n    /**\n     * @return {Number}\n     */\n    getItemId() {\n        return Number.parseInt(this.#element.dataset.itemid);\n    }\n\n    /**\n     * @return {HTMLElement}\n     */\n    getItemInfo() {\n        return this.#element.querySelector('.info');\n    }\n\n    /**\n     * @param {HTMLElement} item\n     * @param {Boolean|NULL} collapse\n     */\n    toggleCollapse(item, collapse = null) {\n        if (item.dataset.type !== 'course' && item.dataset.type !== 'section') {\n            return;\n        }\n\n        if (collapse !== null) {\n            item.dataset.collapsed = collapse ? 'true' : 'false';\n        } else {\n            item.dataset.collapsed = item.dataset.collapsed === 'true' ? 'false' : 'true';\n        }\n\n        const iconElement = item.querySelector('.info > i');\n        iconElement.classList.remove('fa-folder-o', 'fa-folder-open-o');\n        iconElement.classList.add(item.dataset.collapsed === 'true' ? 'fa-folder-o' : 'fa-folder-open-o');\n    }\n\n    isModule() {\n        return !this.isCourse() && !this.isSection();\n    }\n\n    isCourse() {\n        return this.#element.dataset.type === 'course';\n    }\n\n    isSection() {\n        return this.#element.dataset.type === 'section';\n    }\n\n    /**\n     * @param {Event} e\n     */\n    toggleCollapseRecursively(e) {\n        e.preventDefault();\n        e.stopPropagation();\n\n        if(this.isModule()) {\n            return;\n        }\n\n        this.toggleCollapse(this.#element);\n        this.getItemChildrenRecursively().forEach((item) => {\n            this.toggleCollapse(item, this.#element.dataset.collapsed === 'true');\n        });\n    }\n\n    remove() {\n        this.#element.remove();\n    }\n}"],"names":["constructor","baseFactory","blockElement","element","addEventListeners","addEventListener","this","toggleCollapseRecursively","bind","querySelector","confirmDeleteItem","copyItemToCourse","e","preventDefault","stopPropagation","_classPrivateFieldGet","setClipboard","strings","key","component","modal","ModalFactory","create","type","types","DELETE_CANCEL","title","getItemName","body","buttons","delete","cancel","removeOnClose","getRoot","on","ModalEvents","deleteItem","show","getItemChildrenRecursively","querySelectorAll","innerText","getItemId","Number","parseInt","dataset","itemid","getItemInfo","toggleCollapse","item","collapse","collapsed","iconElement","classList","remove","add","isModule","isCourse","isSection","forEach"],"mappings":"+mDAsBIA,YAAYC,YAAaC,aAAcC,yQACfF,sDACCC,kDACLC,SAGpBC,2GACkBC,iBAAiB,QAASC,KAAKC,0BAA0BC,KAAKF,2EAE9DG,cAAc,oFAA2BJ,iBAAiB,QAASC,KAAKI,kBAAkBF,KAAKF,2EAC/FG,cAAc,4FAAmCJ,iBAAiB,QAASC,KAAKK,iBAAiBH,KAAKF,8BAGjGM,GACnBA,EAAEC,iBACFD,EAAEE,wBAEIC,0CAAmBC,aAAaV,8BAGlBM,GACpBA,EAAEC,iBACFD,EAAEE,wBAEIG,cAAgB,oBAAY,CAC9B,CACIC,IAAK,cACLC,UAAW,sBAEf,CACID,IAAK,sBACLC,UAAW,sBAEf,CACID,IAAK,SACLC,UAAW,QAEf,CACID,IAAK,SACLC,UAAW,UAIbC,YAAcC,uBAAaC,OAAO,CACpCC,KAAMF,uBAAaG,MAAMC,cACzBC,MAAOT,QAAQ,GAAK,MAAQX,KAAKqB,cAAgB,IACjDC,KAAMX,QAAQ,GACdY,QAAS,CACLC,OAAQb,QAAQ,GAChBc,OAAQd,QAAQ,IAEpBe,eAAe,IAEnBZ,MAAMa,UAAUC,GAAGC,sBAAYL,OAAQf,0CAAmBqB,WAAW5B,2BAAKF,oBAAoBA,aACxFc,MAAMiB,OAMhBC,oCACWvB,qCAAcwB,iBAAiB,sBAM1CZ,qBACWZ,qCAAcN,cAAc,SAAS+B,UAMhDC,mBACWC,OAAOC,SAAS5B,qCAAc6B,QAAQC,QAMjDC,qBACW/B,qCAAcN,cAAc,SAOvCsC,eAAeC,UAAMC,gEAAW,QACF,WAAtBD,KAAKJ,QAAQrB,MAA2C,YAAtByB,KAAKJ,QAAQrB,YAK/CyB,KAAKJ,QAAQM,UADA,OAAbD,SACyBA,SAAW,OAAS,QAEO,SAA3BD,KAAKJ,QAAQM,UAAuB,QAAU,aAGrEC,YAAcH,KAAKvC,cAAc,aACvC0C,YAAYC,UAAUC,OAAO,cAAe,oBAC5CF,YAAYC,UAAUE,IAA+B,SAA3BN,KAAKJ,QAAQM,UAAuB,cAAgB,oBAGlFK,kBACYjD,KAAKkD,aAAelD,KAAKmD,YAGrCD,iBAC0C,WAA/BzC,qCAAc6B,QAAQrB,KAGjCkC,kBAC0C,YAA/B1C,qCAAc6B,QAAQrB,KAMjChB,0BAA0BK,GACtBA,EAAEC,iBACFD,EAAEE,kBAECR,KAAKiD,kBAIHR,qCAAezC,qBACfgC,6BAA6BoB,SAASV,YAClCD,eAAeC,KAA0C,SAApCjC,qCAAc6B,QAAQM,eAIxDG,8CACkBA"}